/* Copyright (C) YOOtheme GmbH, http://www.gnu.org/licenses/gpl.html GNU/GPL */

!function(e,a,t){e(function(){var a=e("#config"),o=Joomla.submitbutton;e(".nav-tabs").on("click","[data-toggle]",function(){t._tab=e(this).attr("href")}),setTimeout(function(){t._tab&&e(".nav-tabs [href='"+t._tab+"']").trigger("click")},1),Joomla.submitbutton=function(e){"style.save"==e?n.save("save",e):"style.save2copy"==e?n.save("save-copy",e):"style.apply"==e?n.save("apply",e):o(e)},e("#templatestyleOptions").length?a.closest("#templatestyleOptions").before(a).remove():e("#attrib-options").prepend(a).find(".control-group").hide(),setTimeout(function(){a.find(".chzn-container").each(function(){e(this).prev().show().end().remove()})},200)});var n={save:function(a,t){var n={},o=e('form[name="adminForm"]'),s=o.find("#jform_template").val(),r=e("#toolbar-"+a);r.addClass("saving"),parse_str(e(":input","#config").serialize(),n),e.ajax({url:o.attr("action"),type:"post",data:{option:"com_templates",template:s,callback:"config",tmpl:"warp-ajax",config:JSON.stringify(n,null,"	")},success:function(n){r.removeClass("saving");try{if(n=e.parseJSON(n),"success"!=n.message)return void alert("Save failed!")}catch(o){}a.match(/(apply|save)$/)&&e("#config").remove(),submitbutton(t)}})},saveFiles:function(a){var t=e.Deferred(),n=e('form[name="adminForm"]'),o=n.find("#jform_template").val(),s=new FormData;return s.append("option","com_templates"),s.append("template",o),s.append("callback","files"),s.append("tmpl","warp-ajax"),s.append("no_html",1),s.append("files",new Blob([window.btoa(JSON.stringify(a))],{type:"text/plain"})),e.ajax({url:n.attr("action"),type:"POST",data:s,processData:!1,contentType:!1}).always(function(a,n,o){var s=!1;if("error"==n)s=o;else try{a=e.parseJSON(a),"success"!=a.message&&(s=a.message)}catch(r){s="Saving failed!"}t[s?"reject":"resolve"](s)}),t.promise()},data:function(){var a=e.Deferred(),t=e('form[name="adminForm"]'),n=t.find("#jform_template").val();return e.ajax({url:t.attr("action"),type:"post",data:{option:"com_templates",template:n,callback:"styles",tmpl:"warp-ajax",no_html:1}}).always(function(t,n,o){var s=!1;if("error"==n)s=o;else try{if(t=e.parseJSON(t),"error"!=t.message)return void a.resolve(t);s=t.message}catch(r){s="Retrieving styles data failed!"}a.reject(s)}),a.promise()}};a.System=n}(jQuery,this,window.sessionStorage||{});